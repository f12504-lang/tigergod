<!DOCTYPE html>
<!-- saved from url=(0037)https://tiger-29428890-19bec.web.app/ -->
<html lang="zh-Hant"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>æ–ç±¤è©©ï½œç¥ˆç¦å­˜éŒ¢å°éŠæˆ²</title>
  <meta name="description" content="NFC è§¸ç™¼å¾Œç©çš„æ–ç±¤è©©å°éŠæˆ²ï¼Œçµåˆç¥ˆç¦èˆ‡å„²è“„å»ºè­°ï¼Œæ”¯æ´æ–ä¸€æ–èˆ‡é»æ“ŠæŠ½ç±¤ã€é›¢ç·šç´€éŒ„èˆ‡å°å¡ä¸‹è¼‰ã€‚">
  <style>
    :root{
      --bg:#fff8f0; --primary:#b51111; --ink:#2b2b2b; --gold:#c9a227; --muted:#946a28; --paper:#fffdfa;
    }
    *{box-sizing:border-box}
    html,body{height:100%;}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans TC",sans-serif;
      background:radial-gradient(1000px 600px at 50% -10%, #ffe5cf 0%, var(--bg) 50%, var(--bg) 100%);
      color:var(--ink); display:flex; align-items:center; justify-content:center;
    }
    .app{width:min(740px, 100%); padding:16px;}
    .card{background:var(--paper); border:2px solid #e9d8b4; border-radius:20px; box-shadow:0 10px 30px rgba(0,0,0,.08);
      overflow:hidden;}
    header{padding:20px 18px; background:linear-gradient(180deg, #fff7ec, #fff1da);
      border-bottom:2px solid #f0dfb6; position:relative}
    .title{display:flex; align-items:center; gap:12px}
    .logo{width:48px; height:48px; border-radius:14px; display:grid; place-items:center; background:conic-gradient(from 0deg, #ffefc2, #ffd283, #ffefc2);
      box-shadow:inset 0 0 0 2px #f3d9a8}
    .logo svg{width:28px; height:28px;}
    h1{margin:0; font-size:20px; color:var(--primary); letter-spacing:.08em}
    .subtitle{margin:2px 0 0; font-size:12px; color:#7a6a55}

    .statusbar{display:flex; gap:8px; flex-wrap:wrap; margin-top:10px}
    .pill{font-size:12px; border:1px dashed #ddb87a; padding:6px 10px; border-radius:999px; background:#fff9ee; color:#7c6123}
    .pill.good{border-style:solid; border-color:#c8a24a}

    .stage{padding:22px 18px 10px;}
    .lotbox{display:grid; grid-template-columns:1fr; justify-items:center;}
/* ===== ç±¤ç­’èˆ‡ logo ===== */
    .lotbox img {
    position: absolute;
    left: 50%;
    bottom: 30px; /* è²¼åœ¨ç±¤ç­’ä¸Šæ–¹ï¼Œä¾æ¯”ä¾‹èª¿æ•´ */
    transform: translateX(-50%);
    width: 18%;
    height: auto;
    z-index: 10;
    
    }
    @media (max-width: 480px) {
      .lotbox img {
        bottom: 10%;
        width: 34%;
      }
    }
    .ç­®æ¡¶{position:relative; width:min(340px, 86vw); height:220px; margin:6px 0 14px;}
    .æ¡¶{position:absolute; inset:auto 0 0; margin:auto; width:100%; height:70%; background:linear-gradient(180deg, #b20 0%, #790 0%, #8a0 0%);}
    /* Wooden bucket body */
    .æ¡¶:before{content:""; position:absolute; inset:0; background:linear-gradient(180deg, #b31111 0%, #8f0f0f 60%, #740b0b 100%);
      border-radius:18px 18px 14px 14px; box-shadow:inset 0 10px 18px rgba(0,0,0,.25), inset 0 -10px 18px rgba(0,0,0,.2);}    
    .æ¡¶:after{content:""; position:absolute; left:8%; right:8%; top:14px; height:8px; border-radius:999px; background:linear-gradient(180deg,#caa65a,#9f7b20); box-shadow:0 2px 0 rgba(0,0,0,.1)}

    /* Sticks */
    .sticks{position:absolute; left:50%; bottom:60%; transform:translateX(-50%); width:80%; height:160px; display:flex; align-items:flex-end; justify-content:center; gap:6px; perspective:800px}
    .stick{width:16px; height:120px; background:linear-gradient(180deg, #d3b37a, #b68c43); border-radius:6px; box-shadow:inset 0 0 0 1px #b38a3a, 0 6px 12px rgba(0,0,0,.12); transform-origin:50% 100%;}
    .stick i{display:block; margin:8px auto 0; width:70%; height:14px; background:#8a5f15; border-radius:3px; opacity:.75}

    .shake{animation:sha 0.5s ease-in-out 0s 1}
    @keyframes sha{0%{transform:translateX(-50%) rotate(-2deg)}25%{transform:translateX(-50%) rotate(2deg)}50%{transform:translateX(-50%) rotate(-3deg)}75%{transform:translateX(-50%) rotate(3deg)}100%{transform:translateX(-50%) rotate(0)}}

    .actions{display:flex; align-items:center; justify-content:center; gap:10px; margin:8px 0 2px; flex-wrap:wrap}
    button{appearance:none; border:none; background:linear-gradient(180deg, #f9e2a7, #e6c66e); color:#684b06; padding:12px 16px; border-radius:12px; font-weight:700; letter-spacing:.08em; cursor:pointer; box-shadow:0 6px 14px rgba(0,0,0,.12);}
    button.primary{background:linear-gradient(180deg, #fbe3a9, #f0c862); border:1px solid #e1b34c}
    button.ghost{background:#fff7ea; border:1px dashed #e0c28c}
    button:disabled{opacity:.6; cursor:not-allowed}

    .result{margin:14px auto 0; width:min(560px, 94%); background:#fffdf8; border:1px solid #edd6a6; border-radius:16px; padding:14px 14px 10px; display:none}
    .badge{display:inline-block; font-size:12px; padding:4px 8px; border-radius:999px; background:#fff0c6; border:1px solid #efc972; color:#865a0b}
    .lot-title{margin:6px 0 0; font-size:18px; color:var(--primary)}
    .poem{margin:8px 0; padding:10px 12px; background:#fffaf0; border-left:3px solid #dfb050; line-height:1.6; border-radius:8px}
    .advice{margin:0; color:#5a4a34}

    .footer{padding:12px 18px 18px; color:#7b6b54; font-size:12px; display:flex; justify-content:space-between; gap:12px; flex-wrap:wrap}
    .kudos{display:flex; align-items:center; gap:6px}

    .toast{position:fixed; left:50%; bottom:18px; transform:translateX(-50%); background:#2b2b2b; color:#fff; padding:10px 14px; border-radius:999px; font-size:13px; opacity:0; pointer-events:none; transition:opacity .25s}
    .toast.show{opacity:1}

    @media (prefers-reduced-motion:no-preference){
      .stick.swing{animation:swing .7s ease-in-out infinite alternate}
      @keyframes swing{from{transform:rotateX(0deg) rotateZ(-4deg)} to{transform:rotateX(6deg) rotateZ(4deg)}}
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="card" role="main" aria-label="æ–ç±¤è©©å°éŠæˆ²">
      <header>
        <div class="title">
          <div class="logo" aria-hidden="true">
            <!-- å…ƒå¯¶åœ–ç¤º -->
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" xmlns="http://www.w3.org/2000/svg">
              <path d="M3 12c3-4 6-6 9-6s6 2 9 6c-3 4-6 6-9 6s-6-2-9-6Z" fill="#f4c542" stroke="#a87908"></path>
              <circle cx="12" cy="12" r="2.4" fill="#ffefc2" stroke="#a87908"></circle>
            </svg>
          </div>
          <div>
            <h1>æ–ç±¤è©©ï½œç¥ˆç¦å­˜éŒ¢</h1>
            <p class="subtitle">æ„Ÿæ‡‰å­˜éŒ¢ç­’å¾Œï¼Œæ–ä¸€æ–æŠ½ä»Šæ—¥ç±¤ï¼Œå¾—åˆ°å°ˆå±¬çš„å„²è“„å»ºè­°ã€‚</p>
          </div>
        </div>
        <div class="statusbar" id="statusbar"><span class="pill good">H5 ç¶²é éŠæˆ²</span><span class="pill good">æ–ä¸€æ–åµæ¸¬å¯ç”¨</span><span class="pill good">éœ‡å‹•å›é¥‹å¯ç”¨</span><span class="pill ">Web NFCä¸å¯ç”¨</span></div>
      </header>

      <section class="stage">
        <div class="lotbox" aria-live="polite">
 	
          <div class="ç­®æ¡¶" aria-hidden="true">
			  
            <div class="sticks" id="sticks"><div class="stick swing" style="height: 127.685px; transform: rotate(-1.46313deg);"><i></i></div><div class="stick swing" style="height: 112.815px; transform: rotate(1.08347deg);"><i></i></div><div class="stick swing" style="height: 119.222px; transform: rotate(1.19258deg);"><i></i></div><div class="stick swing" style="height: 120.693px; transform: rotate(-0.275324deg);"><i></i></div><div class="stick swing" style="height: 108.9px; transform: rotate(-2.79287deg);"><i></i></div><div class="stick swing" style="height: 108.136px; transform: rotate(-0.192849deg);"><i></i></div><div class="stick swing" style="height: 105.854px; transform: rotate(1.47518deg);"><i></i></div><div class="stick swing" style="height: 107.975px; transform: rotate(-2.90288deg);"><i></i></div><div class="stick swing" style="height: 116.258px; transform: rotate(-0.0421887deg);"><i></i></div><div class="stick swing" style="height: 119.463px; transform: rotate(-2.31077deg);"><i></i></div><div class="stick swing" style="height: 117.817px; transform: rotate(-1.23961deg);"><i></i></div><div class="stick swing" style="height: 115.885px; transform: rotate(-2.88271deg);"><i></i></div><div class="stick swing" style="height: 109.673px; transform: rotate(-1.88389deg);"><i></i></div><div class="stick swing" style="height: 120.363px; transform: rotate(-2.55968deg);"><i></i></div><div class="stick swing" style="height: 121.704px; transform: rotate(-3.51929deg);"><i></i></div><div class="stick swing" style="height: 119.667px; transform: rotate(-0.368384deg);"><i></i></div><div class="stick swing" style="height: 110.832px; transform: rotate(1.75576deg);"><i></i></div><div class="stick swing" style="height: 114.463px; transform: rotate(-2.40499deg);"><i></i></div><div class="stick swing" style="height: 121.161px; transform: rotate(-3.60246deg);"><i></i></div><div class="stick swing" style="height: 129.626px; transform: rotate(0.485543deg);"><i></i></div><div class="stick swing" style="height: 122.623px; transform: rotate(0.568499deg);"><i></i></div></div>
            <div class="æ¡¶">
			  <img src="imeage/logo.png" alt="Logo"/>
			  </div>
          </div>
          <div class="actions">
            <button class="primary" id="shakeBtn">æ–ä¸€æ–æŠ½ç±¤</button>
            <button class="ghost" id="saveCardBtn" disabled="">ä¸‹è¼‰ç¦æ°£å°å¡</button>
            <button class="ghost" id="resetBtn">å†æŠ½ä¸€æ¬¡</button>
          </div>
        </div>

        <article class="result" id="result">
          <span class="badge" id="nfcBadge" style="display:none">NFC å·²æ„Ÿæ‡‰</span>
          <h2 class="lot-title" id="lotTitle">â€”</h2>
          <div class="poem" id="poem">â€”</div>
          <p class="advice" id="advice">â€”</p>
        </article>
      </section>

      <div class="footer">
        <div class="kudos">ğŸ“… <span id="streak">é€£çºŒç°½åˆ°ï¼š1 å¤©</span>ï½œğŸ”¢ <span id="count">ä»Šæ—¥æŠ½ç±¤ï¼š0 æ¬¡</span></div>
        <div>ğŸ’¡ å°æŠ€å·§ï¼šè‹¥æ‰‹æ©Ÿä¸æ”¯æ´æ–å‹•åµæ¸¬ï¼Œå¯ç›´æ¥æŒ‰ã€Œæ–ä¸€æ–æŠ½ç±¤ã€ã€‚</div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>

  <script>
    // === å…§å®¹è³‡æ–™ï¼šç°½è©© ===
    const LOTS = [
      {grade:'å¤§å‰', poem:'é‡‘é¢¨é€å–œæ»¿ç­’é¦™ï¼Œå‹¤å„²ç²’ç±³èšæˆå€‰ã€‚', advise:'ä»Šå¤©å¾ˆé©åˆæŠŠé›¶éŒ¢æˆ– 50 å…ƒç¡¬å¹£æŠ•é€²å­˜éŒ¢ç­’ï¼Œè®“å°ç¦æ°£è®Šå¤§ç¦æ°£ã€‚'},
      {grade:'ä¸­å‰', poem:'æ­¥æ­¥ç‚ºç‡Ÿç©©ä¸­é€²ï¼Œç´°æµçµ‚æˆå¤§æ±Ÿæ¿±ã€‚', advise:'æŠŠæœ¬é€±é›¶ç”¨çš„ä¸€æˆå­˜èµ·ä¾†ï¼Œå…ˆå­˜å°æ•¸å­—ä¹Ÿèƒ½æŒçºŒå‰é€²ã€‚'},
      {grade:'å°å‰', poem:'æ‹ˆé¦™ä¸€æŸ±å¿ƒä¸åï¼Œæ»´æ°´é›–å¾®èƒ½ç©¿å²©ã€‚', advise:'è¨­ä¸€å€‹ 7 æ—¥å¾®ç›®æ¨™ï¼šæ¯å¤©å­˜ 20 å…ƒï¼Œå®Œæˆå°±å¹«è‡ªå·±è²¼ä¸€å¼µç¦è²¼ã€‚'},
      {grade:'å¹³', poem:'é›²é–‹åŠé¢è¦‹é’å¤©ï¼ŒæŒä¹‹æœ‰æ†ç¦è‡ªé€£ã€‚', advise:'æŠŠã€Œå›ºå®šè½‰å…¥ã€æ‰“é–‹ï¼Œæ¯é€±å›ºå®šè½‰ 100 å…ƒé€²å­˜æ¬¾ï¼Œä¸ç”¨æƒ³ä¹Ÿèƒ½å­˜ã€‚'},
      {grade:'å°å‡¶', poem:'é¢¨æ€¥ç«¹é³´å¿ƒæ˜“äº‚ï¼Œæ”¶æ–‚æ¬²å¿µä¿å¹³å®‰ã€‚', advise:'ä»Šå¤©æš«ç·©è¡å‹•è³¼ç‰©ï¼ŒæŠŠæƒ³è²·çš„æ±è¥¿åŠ å…¥ 72 å°æ™‚æ¸…å–®ï¼Œå†æ±ºå®šè¦ä¸è¦ã€‚'},
      {grade:'ä¸­å¹³', poem:'ä¸€ç‡ˆåœ¨æ‰‹ç…§æ­§è·¯ï¼Œå¯©æ€æ–¹å¯¸å…é¡›ç°¸ã€‚', advise:'è¨˜ä¸€ç­†ä»Šæ—¥èŠ±è²»ï¼Œå¯«ä¸‹ã€Œå¿…è¦ / æƒ³è¦ã€å…©åˆ—ï¼Œæ˜å¤©å›çœ‹æœƒæ›´æ¸…æ¥šã€‚'},
      {grade:'å‰', poem:'ç¦è‡³å¿ƒéˆè²¡è·¯é€šï¼Œç©æ²™èšå¡”å¥½æ™‚ä¸­ã€‚', advise:'æŠŠé›¶ç”¨æ‰¾é›¶éƒ½æ”¾é€²å­˜éŒ¢ç­’ï¼›è‹¥æœ‰è½‰å¸³å°±å–æ•´æ•¸æŠŠå°¾æ•¸å­˜èµ·ä¾†ã€‚'},
      {grade:'åŠå‰', poem:'å°èˆŸå…¥æ¸¯é¢¨ç•¥æ€¥ï¼Œç¹«ç‰¢çºœç´¢å†å•Ÿè¡Œã€‚', advise:'æª¢æŸ¥é€™é€±æ˜¯å¦æœ‰è¨‚é–±æ²’åœ¨ç”¨ï¼Œåœæ‰ä¸€å€‹ï¼ŒæŠŠçœä¸‹ä¾†çš„éŒ¢å­˜å…¥ã€‚'},
    ];

    // === ç‹€æ…‹ ===
    const el = (id)=>document.getElementById(id);
    const sticksWrap = el('sticks');
    const result = el('result');
    const lotTitle = el('lotTitle');
    const poem = el('poem');
    const advice = el('advice');
    const toast = el('toast');
    const streakEl = el('streak');
    const countEl = el('count');
    const nfcBadge = el('nfcBadge');

    const STATUS_KEYS = { lastDate:'lot_last_date', streak:'lot_streak', todayCount:'lot_today_count' };

    let shaking = false;
    let todayCount = 0;

    // å»ºç«‹ 21 æ ¹ç«¹ç±¤è¦–è¦º
    const STICK_COUNT = 21;
    function buildSticks(){
      sticksWrap.innerHTML = '';
      for(let i=0;i<STICK_COUNT;i++){
        const s = document.createElement('div');
        s.className = 'stick swing';
        s.style.height = (100 + Math.random()*30) + 'px';
        s.style.transform = `rotate(${(Math.random()*8-4)}deg)`;
        s.innerHTML = '<i></i>'
        sticksWrap.appendChild(s);
      }
    }

    // è®€å¯«æœ¬åœ°å„²å­˜ï¼šç°½åˆ°èˆ‡æ¬¡æ•¸
    function loadDaily(){
      const today = new Date();
      const dkey = today.toISOString().slice(0,10);
      const last = localStorage.getItem(STATUS_KEYS.lastDate);
      let streak = parseInt(localStorage.getItem(STATUS_KEYS.streak)||'0',10);
      if(last===dkey){
        todayCount = parseInt(localStorage.getItem(STATUS_KEYS.todayCount)||'0',10);
      } else {
        // æ–°çš„ä¸€å¤©
        if(last){
          const diff = (today - new Date(last)) / (1000*60*60*24);
          streak = diff<=1.9 ? (streak+1) : 1; // å®¹éŒ¯ 1 å¤©
        } else {
          streak = 1;
        }
        todayCount = 0;
        localStorage.setItem(STATUS_KEYS.lastDate, dkey);
        localStorage.setItem(STATUS_KEYS.streak, String(streak));
        localStorage.setItem(STATUS_KEYS.todayCount, '0');
      }
      streakEl.textContent = `é€£çºŒç°½åˆ°ï¼š${streak} å¤©`;
      countEl.textContent = `ä»Šæ—¥æŠ½ç±¤ï¼š${todayCount} æ¬¡`;
    }

    function bumpCount(){
      todayCount += 1;
      localStorage.setItem(STATUS_KEYS.todayCount, String(todayCount));
      countEl.textContent = `ä»Šæ—¥æŠ½ç±¤ï¼š${todayCount} æ¬¡`;
    }

    // æŠ½ç±¤ä¸»æµç¨‹
    function shakeOnce(){
      if(shaking) return;
      shaking = true;
      sticksWrap.classList.add('shake');
      if('vibrate' in navigator) navigator.vibrate(60);
      setTimeout(()=>{
        sticksWrap.classList.remove('shake');
        const idx = Math.floor(Math.random()*LOTS.length);
        const lot = LOTS[idx];
        showResult(lot);
        bumpCount();
        shaking = false;
      }, 600);
    }

    function showResult(lot){
      result.style.display = 'block';
      lotTitle.textContent = `${lot.grade}ç±¤ ï¼ ç¬¬${Math.floor(Math.random()*100)+1}è™Ÿ`;
      poem.textContent = lot.poem;
      advice.textContent = 'ğŸ’° å„²è“„å»ºè­°ï¼š' + lot.advise;
      el('saveCardBtn').disabled = false;
    }

    // å°å¡ä¸‹è¼‰ï¼ˆCanvas ç”¢ç”Ÿï¼‰
    function saveCard(){
      const w = 800, h = 1000;
      const cvs = document.createElement('canvas');
      cvs.width = w; cvs.height = h;
      const ctx = cvs.getContext('2d');

      // èƒŒæ™¯
      const grad = ctx.createLinearGradient(0,0,0,h);
      grad.addColorStop(0,'#fff6dd');
      grad.addColorStop(.6,'#ffe6b0');
      grad.addColorStop(1,'#fbe2a9');
      ctx.fillStyle = grad; ctx.fillRect(0,0,w,h);

      // é‚Šæ¡†
      ctx.strokeStyle = '#c9a227'; ctx.lineWidth = 8; ctx.strokeRect(24,24,w-48,h-48);

      // æ¨™é¡Œ
      ctx.fillStyle = '#b51111';
      ctx.font = 'bold 44px Noto Sans TC, system-ui';
      ctx.fillText('ä»Šæ—¥ç±¤è©©ï½œç¥ˆç¦å­˜éŒ¢', 60, 100);

      // å…§å®¹æ¡†
      ctx.fillStyle = '#ffffffcc';
      ctx.fillRect(60, 140, w-120, 640);

      ctx.fillStyle = '#a87312';
      ctx.font = '28px Noto Sans TC, system-ui';
      ctx.fillText(lotTitle.textContent, 80, 200);

      ctx.fillStyle = '#2b2b2b';
      ctx.font = '32px Noto Sans TC, system-ui';
      wrapText(ctx, 'ã€Œ'+poem.textContent+'ã€', 80, 260, w-160, 44);

      ctx.fillStyle = '#5a4a34';
      ctx.font = '26px Noto Sans TC, system-ui';
      wrapText(ctx, advice.textContent, 80, 480, w-160, 36);

      // åº•éƒ¨
      ctx.fillStyle = '#7b6b54';
      ctx.font = '20px Noto Sans TC, system-ui';
      const ds = new Date().toLocaleDateString('zh-TW', {year:'numeric', month:'2-digit', day:'2-digit'});
      ctx.fillText('ç°½åˆ°æ—¥æœŸï¼š'+ds, 60, h-80);
      ctx.fillText('ç”± NFC ç¥ˆç¦å­˜éŒ¢è§¸ç™¼', 60, h-50);

      const url = cvs.toDataURL('image/png');
      const a = document.createElement('a');
      a.href = url; a.download = 'ç¦æ°£å°å¡.png';
      document.body.appendChild(a); a.click(); a.remove();
      showToast('å·²ä¸‹è¼‰ç¦æ°£å°å¡');
    }

    function wrapText(ctx, text, x, y, maxWidth, lineHeight){
      const words = text.split('');
      let line = '', yy = y;
      for(const ch of words){
        const test = line + ch;
        if(ctx.measureText(test).width > maxWidth){
          ctx.fillText(line, x, yy); yy += lineHeight; line = ch;
        } else { line = test; }
      }
      if(line) ctx.fillText(line, x, yy);
    }

    // è¨­å‚™æ–å‹•åµæ¸¬ï¼ˆå¯é—œé–‰ï¼‰
    function setupShake(){
      let last = 0, threshold = 17; // é–€æª»å€¼å¯èª¿
      function handler(e){
        const a = e.accelerationIncludingGravity;
        if(!a) return;
        const magnitude = Math.abs(a.x) + Math.abs(a.y) + Math.abs(a.z);
        const now = Date.now();
        if(magnitude > threshold && (now - last) > 900){
          last = now; shakeOnce();
        }
      }
      if(typeof DeviceMotionEvent !== 'undefined' && typeof DeviceMotionEvent.requestPermission === 'function'){
        // iOS éœ€äº’å‹•æˆæ¬Š
        showToast('é»ä¸€ä¸‹å…è¨±ã€Œå‹•ä½œèˆ‡æ–¹å‘ã€ä»¥å•Ÿç”¨æ–ä¸€æ–');
        document.body.addEventListener('click', async ()=>{
          try{ const res = await DeviceMotionEvent.requestPermission(); if(res==='granted'){ window.addEventListener('devicemotion', handler); showToast('å·²å•Ÿç”¨æ–ä¸€æ–'); } }catch{}
        }, {once:true});
      } else if(typeof DeviceMotionEvent !== 'undefined'){
        window.addEventListener('devicemotion', handler);
      }
    }

    // NFC æ¨™è¨˜ï¼ˆURL å¤¾å¸¶ ?nfc=1 æˆ– Web NFC å˜—è©¦ï¼‰
    function setupNFC(){
      const params = new URLSearchParams(location.search);
      if(params.get('nfc')==='1'){ nfcBadge.style.display='inline-block'; return; }
      if('NDEFReader' in window){
        // å˜—è©¦è®€å–ä¸€æ¬¡ï¼ˆéœ€è¦ HTTPS èˆ‡ä½¿ç”¨è€…æ‰‹å‹¢è§¸ç™¼ï¼‰
        const btn = document.getElementById('shakeBtn');
        btn.addEventListener('click', async ()=>{
          try{
            const reader = new NDEFReader();
            await reader.scan();
            reader.onreading = (event)=>{ nfcBadge.style.display='inline-block'; showToast('NFC æ„Ÿæ‡‰æˆåŠŸ'); };
          }catch(err){ /* å¯èƒ½è¢«æ‹’çµ•æˆ–ä¸æ”¯æ´ */ }
        }, {once:true});
      }
    }

    function showToast(msg){ toast.textContent = msg; toast.classList.add('show'); setTimeout(()=>toast.classList.remove('show'), 1600); }

    // äº‹ä»¶ç¶å®š
    document.getElementById('shakeBtn').addEventListener('click', shakeOnce);
    document.getElementById('resetBtn').addEventListener('click', ()=>{
      buildSticks(); result.style.display='none'; el('saveCardBtn').disabled = true; showToast('å·²é‡ç½®ï¼Œæº–å‚™å†æŠ½ä¸€æ¬¡');
    });
    document.getElementById('saveCardBtn').addEventListener('click', saveCard);

    // ç‹€æ…‹åˆ—ï¼šé¡¯ç¤ºè£ç½®èƒ½åŠ›
    function setupStatusbar(){
      const bar = document.getElementById('statusbar');
      const caps = [];
      const cap = (t,good=false)=>`<span class="pill ${good?'good':''}">${t}</span>`;
      caps.push(cap('H5 ç¶²é éŠæˆ²', true));
      caps.push(cap('æ–ä¸€æ–åµæ¸¬'+(typeof DeviceMotionEvent!=='undefined'?'å¯ç”¨':'ä¸å¯ç”¨'), typeof DeviceMotionEvent!=='undefined'));
      caps.push(cap('éœ‡å‹•å›é¥‹'+('vibrate' in navigator?'å¯ç”¨':'ä¸å¯ç”¨'), ('vibrate' in navigator)));
      caps.push(cap('Web NFC'+('NDEFReader' in window?'å¯ç”¨(å¯¦é©—æ€§)':'ä¸å¯ç”¨'), ('NDEFReader' in window)));
      bar.innerHTML = caps.join('');
    }

    // å•Ÿå‹•
    (function init(){
      buildSticks();
      loadDaily();
      setupShake();
      setupNFC();
      setupStatusbar();
    })();
  </script>



</body></html>





